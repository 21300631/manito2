{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrarreloj</title>
    <link rel="stylesheet" href="{% static 'desafios.css'%}">
</head>
<body class="{{ theme }}" data-theme="{{ theme }}">
    <div class="instruccion">
        <span>
            Realiza la mayor cantidad de gestos que se muestran 
            antes de que se acabe el tiempo
        </span>
    </div>
    <div class="contenido">
        <div class="panel-referencia"> 
            <img src="{{ archivo }}" alt="Gesto {{ palabra_correcta }}" width="90%" style="padding: 10%; margin: 0;">        
        </div>
        <div class="panel-usuario gesto g-usuario" >
            <video id="inputVideo" autoplay playsinline muted " ></video>

            <canvas id="outputCanvas" width="600" height="500" style="width: 100%; height: auto;"></canvas>
            <div id="countdown" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 72px; color: white; text-shadow: 2px 2px 4px black;"></div>
            <div id="recordingTimer" style="display: none; position: absolute; top: 20px; right: 20px; font-size: 24px; color: white; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px;"></div>
            <!-- Añade este div para el feedback -->
            <div id="feedback" style="position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 24px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black;"></div>
            
        </div>
    </div>
    <div class="extras">
        <div class="reloj"><span>1:00</span></div>
        <div class="mensaje"><span>Genial</span></div>
        <a href="/inicio/">Cancelar</a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        // Construye la URL correctamente usando static
        const LANDMARKS_JSON_URL = "{% static 'landmarks/' %}" + "{{ palabra_correcta }}.json";
        const PALABRA_ACTUAL = "{{ palabra_correcta }}";
        
        let referenceLandmarks = null;
        
        fetch(LANDMARKS_JSON_URL)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                referenceLandmarks = data;
                console.log("Landmarks de referencia cargados:", referenceLandmarks);
                // Aquí puedes iniciar el proceso de comparación una vez cargados
            })
            .catch(error => {
                console.error("Error cargando landmarks de referencia:", error);
                // Muestra feedback al usuario
                const feedbackElement = document.getElementById('feedback');
                if (feedbackElement) {
                    feedbackElement.textContent = "Error cargando referencia del gesto";
                    feedbackElement.style.color = "red";
                }
            });
    </script>
    <script src="{% static 'contrarreloj.js' %}"></script>
</body>
</html>